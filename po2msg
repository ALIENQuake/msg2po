#!/usr/bin/env python
# coding: utf-8

import re
import sys

version='1.0.0'

source_file=sys.argv[1]
dest_file=sys.argv[2]

with open (source_file, 'r') as po_file:
  lines = {}
  msgid_list = []
  if len(dest_file.rsplit('/', 1)) > 1: #compare only filename
    dest_filename = dest_file.rsplit('/', 1)[1]
  else:
    dest_filename = dest_file

  for line in po_file:
    match = re.findall('^#: .*/([^/]+.msg):(\d+)',line) #compare only filename
    if match:
      m_file = match[0][0]
      seq = match[0][1]
      if m_file == dest_filename:
        msgid_list.append(seq)
    match_gid = re.findall('msgid "(.*)"',line)
    if match_gid:
      gid = match_gid[0]
      gid = gid.replace('\\n','\n')
      gid = gid.replace('\\\\','\\')
    match_str = re.findall('msgstr "(.*)"',line)
    if match_str:
      string = match_str[0]
      string = string.replace('\\n','\n')
      string = string.replace('\\\\','\\')
      if len(msgid_list) > 0:
        for msgid in msgid_list:
          msgid_seq = msgid_list.pop()
          if len(string) > 0:
            lines[msgid_seq] = string
          else:
            lines[msgid_seq] = gid

  lines2=[]
  lines = {int(k):v for k,v in lines.items()} #convert key to int
  keylist = lines.keys()
  keylist.sort()
  for n in keylist:
    lines2.append('{{{}}}{{}}{{{}}}\n'.format(n,lines[n]))

  for l2 in lines2:
    print l2,
