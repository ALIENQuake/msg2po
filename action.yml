name: BGforge poify/unpoify
description: Updates Gettext POT template from source language, extracts translations from PO files, commits and pushes the files.
branding:
  icon: message-circle
  color: green

inputs:
  poify:
    description: run poify
    default: 'true'
    required: false
  msgmerge:
    description: update PO files from POT
    default: 'true'
    required: false
  unpoify:
    description: run unpoify
    default: 'true'
    required: false
  commit:
    description: commit and push poify/unpoify results
    default: 'true'
    required: false
  separate_commits:
    description: use separate commits for poify and unpoify, or a single one
    default: 'true'
    required: false

runs:
  using: "composite"
  steps:
    - run: |
        set -xeu -o pipefail
        if [ "$RUNNER_OS" == "Linux" ]; then
          apt install gettext
        elif [ "$RUNNER_OS" == "Windows" ]; then
          wget https://github.com/mlocati/gettext-iconv-windows/releases/download/v0.21-v1.16/gettext0.21-iconv1.16-static-32.zip -O gettext.zip
          7z e gettext.zip bin/msgmerge.exe
          mv msgmerge.exe "$GITHUB_ACTION_PATH"/
          rm gettext.zip
        else
          echo "$RUNNER_OS not supported"
          exit 1
        fi
        pip3 install -r "$GITHUB_ACTION_PATH/requirements.txt"
        echo "{$GITHUB_ACTION_PATH}" >> $GITHUB_PATH
        $GITHUB_ACTION_PATH/gha.sh
      shell: bash
      env:
        INPUT_POIFY: ${{ inputs.poify }}
        INPUT_UNPOIFY: ${{ inputs.unpoify }}
        INPUT_COMMIT: ${{ inputs.commit }}
        INPUT_SEPARATE_COMMITS: ${{ inputs.separate_commits }}
        INPUT_MSGMERGE: ${{ inputs.msgmerge }}
